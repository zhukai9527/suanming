# æœ¬åœ°åŒ–éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•éƒ¨ç½²å’Œè¿è¡Œå®Œå…¨æœ¬åœ°åŒ–çš„ç¥æœºé˜åº”ç”¨ã€‚

## ğŸ¯ æœ¬åœ°åŒ–æ”¹é€ æ¦‚è¿°

æœ¬é¡¹ç›®å·²ä»åŸºäºSupabaseçš„äº‘ç«¯æ¶æ„å®Œå…¨è½¬æ¢ä¸ºæœ¬åœ°åŒ–æ¶æ„ï¼š

### æ¶æ„å˜æ›´
- **æ•°æ®åº“**: PostgreSQL (Supabase) â†’ SQLite (æœ¬åœ°æ–‡ä»¶)
- **åç«¯**: Supabase Edge Functions â†’ Express.js æœåŠ¡å™¨
- **è®¤è¯**: Supabase Auth â†’ JWT + bcrypt
- **API**: Supabaseå®¢æˆ·ç«¯ â†’ æœ¬åœ°APIå®¢æˆ·ç«¯

### ä¿ç•™åŠŸèƒ½
- âœ… å®Œæ•´çš„å…«å­—ã€ç´«å¾®ã€æ˜“ç»åˆ†æåŠŸèƒ½
- âœ… ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æ¡£æ¡ˆç®¡ç†
- âœ… å†å²è®°å½•å­˜å‚¨å’ŒæŸ¥è¯¢
- âœ… æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å’Œç®—æ³•
- âœ… åŸæœ‰çš„ç”¨æˆ·ç•Œé¢å’Œä½“éªŒ

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

### ç³»ç»Ÿè¦æ±‚
- Node.js >= 18.0.0
- npm >= 9.0.0 æˆ– pnpm >= 8.0.0
- Git >= 2.0.0

### æ£€æŸ¥ç¯å¢ƒ
```bash
node --version  # åº”è¯¥ >= 18.0.0
npm --version   # åº”è¯¥ >= 9.0.0
git --version   # åº”è¯¥ >= 2.0.0
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd ai-numerology-refactored
```

### 2. å®‰è£…ä¾èµ–
```bash
npm install
```

### 3. ç¯å¢ƒé…ç½®
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
# é»˜è®¤é…ç½®å·²ç»å¯ä»¥ç›´æ¥ä½¿ç”¨
```

### 4. åˆå§‹åŒ–æ•°æ®åº“
```bash
npm run db:init
```

æ‰§è¡ŒæˆåŠŸåä¼šçœ‹åˆ°ï¼š
```
ğŸ‰ æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼
ğŸ“ æ•°æ®åº“æ–‡ä»¶ä½ç½®: ./numerology.db
âœ… ç®¡ç†å‘˜ç”¨æˆ·åˆ›å»ºæˆåŠŸ
   é‚®ç®±: admin@localhost
   å¯†ç : admin123
âœ… ç¤ºä¾‹æ•°æ®åˆ›å»ºæˆåŠŸ
   æµ‹è¯•ç”¨æˆ·é‚®ç®±: test@example.com
   æµ‹è¯•ç”¨æˆ·å¯†ç : test123
```

### 5. å¯åŠ¨åº”ç”¨

#### å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰
```bash
npm run dev
```
è¿™ä¼šåŒæ—¶å¯åŠ¨åç«¯æœåŠ¡å™¨å’Œå‰ç«¯å¼€å‘æœåŠ¡å™¨ã€‚

#### åˆ†åˆ«å¯åŠ¨
```bash
# ç»ˆç«¯1ï¼šå¯åŠ¨åç«¯æœåŠ¡å™¨
npm run server

# ç»ˆç«¯2ï¼šå¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npx vite
```

### 6. è®¿é—®åº”ç”¨
- å‰ç«¯åœ°å€: http://localhost:5173
- åç«¯API: http://localhost:3001
- å¥åº·æ£€æŸ¥: http://localhost:3001/health

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

#### å‰ç«¯ç¯å¢ƒå˜é‡
```env
# æœ¬åœ°APIæœåŠ¡å™¨åœ°å€
VITE_API_BASE_URL=http://localhost:3001/api
```

#### åç«¯ç¯å¢ƒå˜é‡
```env
# æœåŠ¡å™¨ç«¯å£
PORT=3001

# JWTå¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·æ›´æ”¹ï¼‰
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d

# æ•°æ®åº“æ–‡ä»¶è·¯å¾„
DB_PATH=./numerology.db

# è¿è¡Œç¯å¢ƒ
NODE_ENV=development
```

### æ•°æ®åº“é…ç½®

æ•°æ®åº“æ–‡ä»¶é»˜è®¤ä½ç½®ï¼š`./numerology.db`

#### æ•°æ®åº“ç®¡ç†å‘½ä»¤
```bash
# åˆå§‹åŒ–æ•°æ®åº“
npm run db:init

# å¤‡ä»½æ•°æ®åº“
node server/scripts/initDatabase.cjs backup

# æ¸…ç†è¿‡æœŸæ•°æ®
node server/scripts/initDatabase.cjs cleanup
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
ai-numerology-refactored/
â”œâ”€â”€ server/                 # åç«¯æœåŠ¡å™¨
â”‚   â”œâ”€â”€ database/          # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ index.cjs      # æ•°æ®åº“ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ schema.sql     # æ•°æ®åº“ç»“æ„
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.cjs       # JWTè®¤è¯
â”‚   â”‚   â”œâ”€â”€ errorHandler.cjs # é”™è¯¯å¤„ç†
â”‚   â”‚   â””â”€â”€ logger.cjs     # æ—¥å¿—è®°å½•
â”‚   â”œâ”€â”€ routes/            # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.cjs       # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ analysis.cjs   # åˆ†æè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ history.cjs    # å†å²è®°å½•è·¯ç”±
â”‚   â”‚   â””â”€â”€ profile.cjs    # ç”¨æˆ·æ¡£æ¡ˆè·¯ç”±
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ baziAnalyzer.cjs    # å…«å­—åˆ†æ
â”‚   â”‚   â”œâ”€â”€ yijingAnalyzer.cjs  # æ˜“ç»åˆ†æ
â”‚   â”‚   â””â”€â”€ ziweiAnalyzer.cjs   # ç´«å¾®åˆ†æ
â”‚   â”œâ”€â”€ scripts/           # å·¥å…·è„šæœ¬
â”‚   â”‚   â””â”€â”€ initDatabase.cjs    # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ index.cjs          # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ src/                   # å‰ç«¯æºç 
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ localApi.ts    # æœ¬åœ°APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â””â”€â”€ AuthContext.tsx # è®¤è¯ä¸Šä¸‹æ–‡
â”‚   â””â”€â”€ ...
â”œâ”€â”€ logic/                 # åŸå§‹æ¨ç†é€»è¾‘ï¼ˆå‚è€ƒï¼‰
â”œâ”€â”€ numerology.db          # SQLiteæ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ package.json           # é¡¹ç›®é…ç½®
```

## ğŸ” ç”¨æˆ·è´¦æˆ·

### é¢„è®¾è´¦æˆ·

#### ç®¡ç†å‘˜è´¦æˆ·
- é‚®ç®±: `admin@localhost`
- å¯†ç : `admin123`
- æƒé™: å®Œæ•´è®¿é—®æƒé™

#### æµ‹è¯•è´¦æˆ·
- é‚®ç®±: `test@example.com`
- å¯†ç : `test123`
- æƒé™: æ™®é€šç”¨æˆ·æƒé™
- åŒ…å«ç¤ºä¾‹åˆ†æè®°å½•

### åˆ›å»ºæ–°ç”¨æˆ·
1. è®¿é—®æ³¨å†Œé¡µé¢
2. å¡«å†™é‚®ç®±å’Œå¯†ç 
3. å¯é€‰å¡«å†™å§“å
4. ç‚¹å‡»æ³¨å†Œ

## ğŸ“Š APIæ¥å£

### è®¤è¯æ¥å£
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### åˆ†ææ¥å£
- `POST /api/analysis/bazi` - å…«å­—åˆ†æ
- `POST /api/analysis/ziwei` - ç´«å¾®æ–—æ•°åˆ†æ
- `POST /api/analysis/yijing` - æ˜“ç»å åœåˆ†æ
- `GET /api/analysis/types` - è·å–åˆ†æç±»å‹

### å†å²è®°å½•æ¥å£
- `GET /api/history` - è·å–å†å²è®°å½•
- `GET /api/history/:id` - è·å–å•ä¸ªè®°å½•
- `DELETE /api/history/:id` - åˆ é™¤è®°å½•

### ç”¨æˆ·æ¡£æ¡ˆæ¥å£
- `GET /api/profile` - è·å–ç”¨æˆ·æ¡£æ¡ˆ
- `PUT /api/profile` - æ›´æ–°ç”¨æˆ·æ¡£æ¡ˆ

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### å¼€å‘æ¨¡å¼å¯åŠ¨
```bash
# åŒæ—¶å¯åŠ¨å‰åç«¯ï¼ˆæ¨èï¼‰
npm run dev

# æˆ–åˆ†åˆ«å¯åŠ¨
npm run server  # åç«¯
npx vite        # å‰ç«¯
```

### ä»£ç çƒ­é‡è½½
- åç«¯ï¼šä½¿ç”¨ nodemon è‡ªåŠ¨é‡å¯
- å‰ç«¯ï¼šä½¿ç”¨ Vite çƒ­æ¨¡å—æ›¿æ¢

### è°ƒè¯•
- åç«¯æ—¥å¿—ï¼šæ§åˆ¶å°è¾“å‡º
- å‰ç«¯è°ƒè¯•ï¼šæµè§ˆå™¨å¼€å‘è€…å·¥å…·
- APIæµ‹è¯•ï¼šå¯ä½¿ç”¨ Postman æˆ– curl

## ğŸš¢ ç”Ÿäº§éƒ¨ç½²

### 1. æ„å»ºå‰ç«¯
```bash
npm run build
```

### 2. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```bash
# è®¾ç½®ç”Ÿäº§ç¯å¢ƒ
export NODE_ENV=production

# å¯åŠ¨æœåŠ¡å™¨
npm start
```

### 3. ä½¿ç”¨ PM2 ç®¡ç†è¿›ç¨‹ï¼ˆæ¨èï¼‰
```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨åº”ç”¨
pm2 start server/index.cjs --name "numerology-app"

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs numerology-app
```

### 4. åå‘ä»£ç†é…ç½®ï¼ˆNginxï¼‰
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/dist;
        try_files $uri $uri/ /index.html;
    }
    
    # APIä»£ç†
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥
```bash
# åˆ é™¤ç°æœ‰æ•°æ®åº“æ–‡ä»¶
rm numerology.db

# é‡æ–°åˆå§‹åŒ–
npm run db:init
```

#### 2. ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :3001

# ä¿®æ”¹ç«¯å£ï¼ˆåœ¨ .env æ–‡ä»¶ä¸­ï¼‰
PORT=3002
```

#### 3. å‰ç«¯æ— æ³•è¿æ¥åç«¯
- æ£€æŸ¥åç«¯æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥ `VITE_API_BASE_URL` é…ç½®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

#### 4. JWT token è¿‡æœŸ
```bash
# æ¸…é™¤æµè§ˆå™¨ localStorage
# æˆ–é‡æ–°ç™»å½•
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# åç«¯æ—¥å¿—
npm run server

# å¦‚æœä½¿ç”¨ PM2
pm2 logs numerology-app
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
- å®šæœŸæ¸…ç†è¿‡æœŸä¼šè¯ï¼š`node server/scripts/initDatabase.cjs cleanup`
- æ•°æ®åº“å¤‡ä»½ï¼š`node server/scripts/initDatabase.cjs backup`

### å‰ç«¯ä¼˜åŒ–
- æ„å»ºä¼˜åŒ–ï¼š`npm run build`
- å¯ç”¨ gzip å‹ç¼©
- ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æº

## ğŸ”’ å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒå®‰å…¨
1. **æ›´æ”¹é»˜è®¤å¯†ç **
   ```env
   JWT_SECRET=your-very-secure-random-string
   ```

2. **å¯ç”¨ HTTPS**
   - ä½¿ç”¨ SSL è¯ä¹¦
   - é…ç½®å®‰å…¨å¤´

3. **æ•°æ®åº“å®‰å…¨**
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - é™åˆ¶æ•°æ®åº“æ–‡ä»¶è®¿é—®æƒé™

4. **APIå®‰å…¨**
   - å®æ–½è¯·æ±‚é¢‘ç‡é™åˆ¶
   - è¾“å…¥éªŒè¯å’Œæ¸…ç†
   - é”™è¯¯ä¿¡æ¯ä¸æš´éœ²æ•æ„Ÿä¿¡æ¯

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©
- æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£
- æ£€æŸ¥ GitHub Issues
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### æŠ¥å‘Šé—®é¢˜
è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- æ“ä½œç³»ç»Ÿç‰ˆæœ¬
- Node.js ç‰ˆæœ¬
- é”™è¯¯æ—¥å¿—
- å¤ç°æ­¥éª¤

---

## ğŸ‰ æ­å–œï¼

æ‚¨å·²æˆåŠŸéƒ¨ç½²æœ¬åœ°åŒ–çš„ç¥æœºé˜åº”ç”¨ï¼ç°åœ¨å¯ä»¥ï¼š
- ğŸ”® è¿›è¡Œå…«å­—ã€ç´«å¾®ã€æ˜“ç»åˆ†æ
- ğŸ‘¤ ç®¡ç†ç”¨æˆ·è´¦æˆ·å’Œæ¡£æ¡ˆ
- ğŸ“š æŸ¥çœ‹å’Œç®¡ç†å†å²è®°å½•
- ğŸ”’ äº«å—å®Œå…¨æœ¬åœ°åŒ–çš„æ•°æ®éšç§ä¿æŠ¤

åº”ç”¨å®Œå…¨è¿è¡Œåœ¨æœ¬åœ°ç¯å¢ƒï¼Œæ— éœ€ä¾èµ–ä»»ä½•å¤–éƒ¨æœåŠ¡ï¼Œæ•°æ®å®‰å…¨å¯æ§ã€‚